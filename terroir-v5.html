<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terroir</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #fff;
  --text: #0d0d0d;
  --sub: #aaa;
  --sub2: #ccc;
  --border: #ebebeb;
  --accent: #8b2635;
  --nav-h: 68px;
}
body.dark {
  --bg: #0d0d0d;
  --text: #f0ebe4;
  --sub: #555;
  --sub2: #333;
  --border: #1e1e1e;
}

html, body {
  height: 100%; overflow: hidden;
  background: var(--bg); color: var(--text);
  font-family: 'DM Sans', sans-serif;
  transition: background .3s, color .3s;
}

.app { display: flex; flex-direction: column; height: 100vh; height: 100dvh; }

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.topbar {
  height: 56px; flex-shrink: 0;
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 28px; position: relative;
  border-bottom: 1px solid var(--border);
  transition: border-color .3s;
}
.topbar-logo {
  position: absolute; left: 50%; transform: translateX(-50%);
  font-family: 'Playfair Display', serif;
  font-size: 16px; font-weight: 400;
  letter-spacing: 6px; text-transform: uppercase;
  color: var(--text); transition: color .3s; user-select: none;
}
.type-dots { display: flex; gap: 5px; align-items: center; }
.type-dot {
  width: 4px; height: 4px; border-radius: 50%;
  background: var(--sub2); transition: background .25s, transform .2s;
}
.type-dot.on { background: var(--text); transform: scale(1.4); }

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { flex: 1; overflow: hidden; position: relative; }
.page { position: absolute; inset: 0; overflow: hidden; opacity: 0; pointer-events: none; transition: opacity .2s; }
.page.on { opacity: 1; pointer-events: all; }

/* ‚îÄ‚îÄ CURATION PAGE ‚îÄ‚îÄ */
.cur-wrap { display: flex; flex-direction: column; height: 100%; }

/* Header */
.cur-header {
  padding: 22px 28px 18px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0; transition: border-color .3s;
}
.cur-user {
  font-family: 'DM Mono', monospace;
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub); margin-bottom: 6px;
}
.cur-line {
  font-family: 'Playfair Display', serif;
  font-size: clamp(18px, 2.4vw, 28px);
  font-weight: 400; line-height: 1.2; color: var(--text);
}
.cur-line em { font-style: italic; color: var(--sub); }

/* Type track */
.type-track-wrap { flex: 1; overflow: hidden; position: relative; }
.type-track {
  display: flex; height: 100%;
  transition: transform .42s cubic-bezier(.4,0,.2,1);
  will-change: transform;
}
.type-section {
  min-width: 100%; height: 100%;
  display: flex; flex-direction: column;
  overflow-y: auto; padding: 0;
}

/* ‚îÄ‚îÄ CARD GRID ‚îÄ‚îÄ */
.card-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0;
  flex-shrink: 0;
}

.card-wrap {
  display: flex; flex-direction: column; gap: 8px;
  animation: cardIn .35s ease both;
}
@keyframes cardIn {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}
.card-wrap.dismissing { animation: cardOut .38s ease forwards; }
@keyframes cardOut {
  to { opacity: 0; transform: translateY(-12px); }
}

/* Full-bleed card */
.wine-card {
  position: relative;
  aspect-ratio: 2/3;
  overflow: hidden;
  cursor: pointer;
  background: #111;
}
.card-img {
  position: absolute; inset: 0;
  width: 100%; height: 100%; object-fit: cover;
  transition: transform .55s cubic-bezier(.25,.46,.45,.94), filter .4s ease;
  filter: brightness(.82);
}
.wine-card:hover .card-img { transform: scale(1.04); filter: brightness(.3) blur(10px); }
.wine-card.active .card-img { transform: scale(1.04); filter: brightness(.3) blur(10px); }

/* Card name ‚Äî always visible at bottom */
.card-name-label {
  font-family: 'Playfair Display', serif;
  font-size: 12px; font-weight: 400;
  color: var(--sub); line-height: 1.3;
  padding: 8px 10px 0;
  transition: color .2s;
}
.card-wrap:hover .card-name-label { color: var(--text); }

/* Overlay on hover/active */
.card-overlay {
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  justify-content: space-between;
  padding: 16px 14px;
  opacity: 0; transition: opacity .3s;
  z-index: 3;
}
.wine-card:hover .card-overlay,
.wine-card.active .card-overlay { opacity: 1; }

.ov-top { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.ov-producer { font-size: 10px; font-style: italic; color: rgba(255,255,255,.5); margin-bottom: 10px; }
.ov-why {
  font-size: 11px; font-weight: 300;
  color: rgba(255,255,255,.72); line-height: 1.6;
  border-left: 1.5px solid rgba(255,255,255,.18);
  padding-left: 9px;
}
.ov-hook {
  font-family: 'DM Mono', monospace;
  font-size: 8.5px; letter-spacing: .5px;
  color: rgba(255,255,255,.38);
  line-height: 1.5; margin-top: 10px;
  padding-top: 9px;
  border-top: 1px solid rgba(255,255,255,.08);
}
.ov-meta {
  display: flex; justify-content: space-between; align-items: flex-end;
  margin-top: 10px;
}
.ov-vintage { font-family: 'DM Mono', monospace; font-size: 9px; letter-spacing: 2px; color: rgba(255,255,255,.3); }
.ov-region  { font-family: 'DM Mono', monospace; font-size: 8px; letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,.22); text-align: right; }

/* Minimal action row */
.ov-actions {
  display: flex; gap: 0; margin-top: 12px;
  border-top: 1px solid rgba(255,255,255,.08);
  padding-top: 10px;
}
.ov-btn {
  flex: 1; padding: 5px 0;
  font-family: 'DM Mono', monospace;
  font-size: 7px; letter-spacing: 2px; text-transform: uppercase;
  background: none; border: none;
  color: rgba(255,255,255,.35); cursor: pointer;
  transition: color .15s; text-align: center;
  border-right: 1px solid rgba(255,255,255,.06);
}
.ov-btn:last-child { border-right: none; }
.ov-btn:hover { color: rgba(255,255,255,.9); }
.ov-btn.x { color: rgba(255,255,255,.18); }
.ov-btn.x:hover { color: rgba(200,80,80,.85); }

/* Double-tap hint */
.card-dbl-hint {
  position: absolute; top: 10px; right: 12px;
  font-family: 'DM Mono', monospace;
  font-size: 7px; letter-spacing: 1px; text-transform: uppercase;
  color: rgba(255,255,255,.2); z-index: 4;
  opacity: 0; transition: opacity .3s;
}
.wine-card:hover .card-dbl-hint { opacity: 1; }

/* Swipe hint */
.swipe-hint-row {
  display: flex; justify-content: space-between;
  padding: 12px 28px 16px; flex-shrink: 0;
}
.swipe-hint-txt {
  font-family: 'DM Mono', monospace;
  font-size: 8px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub2); transition: color .3s;
}

/* ‚îÄ‚îÄ DETAIL PANEL (double-click) ‚îÄ‚îÄ */
.detail-overlay {
  position: fixed; inset: 0; z-index: 400;
  background: rgba(0,0,0,.6); backdrop-filter: blur(10px);
  display: none; align-items: stretch;
  animation: fadeIn .25s ease;
}
.detail-overlay.on { display: flex; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.detail-img-panel {
  flex: 1; position: relative; overflow: hidden;
}
.detail-img-panel img {
  width: 100%; height: 100%; object-fit: cover;
  filter: brightness(.7);
}
.detail-img-info {
  position: absolute; bottom: 32px; left: 32px; right: 32px;
}
.detail-wine-name {
  font-family: 'Playfair Display', serif;
  font-size: 28px; font-weight: 400; color: #fff;
  margin-bottom: 4px; line-height: 1.15;
}
.detail-producer { font-size: 14px; font-style: italic; color: rgba(255,255,255,.55); margin-bottom: 14px; }
.detail-tags { display: flex; gap: 8px; flex-wrap: wrap; }
.detail-tag {
  font-family: 'DM Mono', monospace;
  font-size: 8px; letter-spacing: 1.5px; text-transform: uppercase;
  color: rgba(255,255,255,.4);
  border: 1px solid rgba(255,255,255,.15);
  padding: 4px 8px;
}

.detail-chat-panel {
  width: 380px; flex-shrink: 0;
  background: var(--bg);
  display: flex; flex-direction: column;
  transition: background .3s;
}
.detail-chat-head {
  padding: 20px 24px 16px;
  border-bottom: 1px solid var(--border);
  display: flex; justify-content: space-between; align-items: center;
  transition: border-color .3s;
}
.detail-chat-title {
  font-family: 'DM Mono', monospace;
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub);
}
.detail-close {
  background: none; border: none;
  font-size: 18px; color: var(--sub); cursor: pointer;
}
.detail-close:hover { color: var(--text); }

.detail-chat-body {
  flex: 1; overflow-y: auto;
  padding: 20px 24px; display: flex; flex-direction: column; gap: 16px;
}
.chat-msg { display: flex; flex-direction: column; gap: 4px; }
.chat-role {
  font-family: 'DM Mono', monospace;
  font-size: 8px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub);
}
.chat-bubble {
  font-family: 'Playfair Display', serif;
  font-size: 14px; font-weight: 400; line-height: 1.7;
  color: var(--text);
}
.chat-bubble.sommelier { font-style: italic; }

.detail-suggestions {
  padding: 12px 24px;
  display: flex; flex-direction: column; gap: 6px;
  border-top: 1px solid var(--border);
  transition: border-color .3s;
}
.sug-label {
  font-family: 'DM Mono', monospace;
  font-size: 8px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub2); margin-bottom: 4px;
}
.sug-btn {
  background: none;
  border: 1px solid var(--border);
  padding: 9px 14px; text-align: left; cursor: pointer;
  font-family: 'Playfair Display', serif;
  font-size: 13px; color: var(--sub);
  transition: all .15s;
}
.sug-btn:hover { border-color: var(--text); color: var(--text); }

.detail-input-row {
  padding: 14px 24px 20px;
  border-top: 1px solid var(--border);
  display: flex; gap: 8px; align-items: center;
  transition: border-color .3s;
}
.detail-input {
  flex: 1; background: color-mix(in srgb, var(--text) 4%, var(--bg));
  border: 1px solid var(--border); color: var(--text);
  padding: 9px 12px; font-family: 'Playfair Display', serif;
  font-size: 13px; outline: none; transition: border-color .2s, background .3s;
}
.detail-input:focus { border-color: var(--text); }
.detail-input::placeholder { color: var(--sub); font-style: italic; }
.detail-send {
  background: var(--text); border: none; color: var(--bg);
  padding: 9px 14px; cursor: pointer; transition: opacity .2s;
  font-family: 'DM Mono', monospace; font-size: 9px; letter-spacing: 1px; text-transform: uppercase;
}
.detail-send:hover { opacity: .7; }

/* ‚îÄ‚îÄ USER PAGE ‚îÄ‚îÄ */
.user-wrap { display: flex; flex-direction: column; height: 100%; }

.user-header {
  padding: 22px 28px 16px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0; transition: border-color .3s;
}
.user-name-row {
  display: flex; align-items: baseline; gap: 16px; margin-bottom: 4px;
}
.user-name {
  font-family: 'Playfair Display', serif;
  font-size: clamp(18px, 2.4vw, 28px);
  font-weight: 400; color: var(--text);
}
.user-meta {
  font-family: 'DM Mono', monospace;
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub);
}

/* Sub track (My Wines / Taste Map) */
.user-track-wrap { flex: 1; overflow: hidden; }
.user-track {
  display: flex; height: 100%;
  transition: transform .42s cubic-bezier(.4,0,.2,1);
}
.user-section {
  min-width: 100%; height: 100%;
  overflow-y: auto; padding: 20px 28px 24px;
}

/* Section title row */
.sec-title-row {
  display: flex; align-items: baseline; gap: 12px;
  margin-bottom: 20px; padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
  transition: border-color .3s;
}
.sec-title {
  font-family: 'Playfair Display', serif;
  font-size: 20px; font-weight: 400; color: var(--text);
}
.user-dots { display: flex; gap: 5px; align-items: center; }
.user-dot {
  width: 4px; height: 4px; border-radius: 50%;
  background: var(--sub2); transition: background .25s, transform .2s;
}
.user-dot.on { background: var(--text); transform: scale(1.4); }

/* Minimal filter pills */
.filter-row {
  display: flex; gap: 6px; flex-wrap: wrap;
  margin-bottom: 20px;
}
.filter-pill {
  font-family: 'DM Mono', monospace;
  font-size: 9px; letter-spacing: 1.5px; text-transform: uppercase;
  padding: 5px 12px; background: none;
  border: 1px solid var(--border); color: var(--sub);
  cursor: pointer; transition: all .15s;
}
.filter-pill:hover { border-color: var(--text); color: var(--text); }
.filter-pill.on { background: var(--text); border-color: var(--text); color: var(--bg); }

/* Wine entries */
.cel-list { display: flex; flex-direction: column; gap: 1px; }
.cel-entry {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 16px; background: var(--bg);
  border: 1px solid var(--border);
  cursor: pointer; transition: background .15s, border-color .3s;
}
.cel-entry:hover { background: color-mix(in srgb, var(--text) 3%, var(--bg)); }
.cel-left { flex: 1; }
.cel-name { font-family: 'Playfair Display', serif; font-size: 15px; color: var(--text); margin-bottom: 2px; }
.cel-prod { font-size: 11px; font-style: italic; color: var(--sub); }
.cel-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
.cel-badge {
  font-family: 'DM Mono', monospace;
  font-size: 7.5px; letter-spacing: 1.5px; text-transform: uppercase;
  padding: 2px 7px; border: 1px solid;
}
.b-cellar   { color: #b8902a; border-color: #b8902a; }
.b-tasted   { color: #4a8c52; border-color: #4a8c52; }
.b-wishlist { color: #3a78a8; border-color: #3a78a8; }
.b-dismiss  { color: var(--sub); border-color: var(--border); }
.cel-vintage { font-family: 'DM Mono', monospace; font-size: 10px; color: var(--sub); }

/* Taste map */
.taste-essay { margin-bottom: 24px; }
.taste-essay p {
  font-family: 'Playfair Display', serif;
  font-size: 17px; font-weight: 400; line-height: 1.8;
  color: var(--text); max-width: 600px;
}
.taste-essay em { font-style: italic; color: var(--sub); }

.viz-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 1px; background: var(--border); margin-bottom: 1px; transition: background .3s; }
.viz-box { background: var(--bg); padding: 22px; transition: background .3s; }
.viz-lbl {
  font-family: 'DM Mono', monospace;
  font-size: 8px; letter-spacing: 3px; text-transform: uppercase;
  color: var(--sub); margin-bottom: 14px;
}
.wcloud { display: flex; flex-wrap: wrap; gap: 6px; align-items: baseline; }
.wc {
  font-family: 'Playfair Display', serif; font-style: italic;
  color: var(--sub); cursor: default; transition: color .2s; line-height: 1.2;
}
.wc:hover { color: var(--text); }

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav {
  height: var(--nav-h); flex-shrink: 0;
  border-top: 1px solid var(--border);
  background: var(--bg);
  display: flex; align-items: center;
  transition: background .3s, border-color .3s;
  position: relative;
}
.bnav-btn {
  flex: 1; display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 4px;
  background: none; border: none; cursor: pointer; height: 100%;
}
.bnav-icon { color: var(--sub); transition: color .2s; }
.bnav-label {
  font-family: 'DM Mono', monospace;
  font-size: 8px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--sub); transition: color .2s;
}
.bnav-btn.on .bnav-icon,
.bnav-btn.on .bnav-label { color: var(--text); }
.bnav-center { flex: 1; } /* spacer for center button */
.bnav-add {
  position: absolute; left: 50%; top: 50%;
  transform: translate(-50%, -50%);
  width: 46px; height: 46px; border-radius: 50%;
  background: var(--text); border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 2px 14px rgba(0,0,0,.14);
  transition: opacity .2s, background .3s;
}
.bnav-add:hover { opacity: .75; }
.bnav-add svg { color: var(--bg); transition: color .3s; }

/* Theme btn */
.theme-btn {
  position: fixed; top: 14px; right: 22px;
  width: 26px; height: 26px; border-radius: 50%;
  background: var(--text); border: none; cursor: pointer;
  z-index: 300; transition: background .3s;
}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-bg {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(0,0,0,.45); backdrop-filter: blur(8px);
  display: none; align-items: flex-end; justify-content: center;
}
.modal-bg.on { display: flex; }
.modal {
  background: var(--bg); width: 100%; max-width: 520px;
  border-top: 1px solid var(--border);
  animation: slideUp .28s cubic-bezier(.4,0,.2,1);
  transition: background .3s, border-color .3s;
  max-height: 88vh; overflow-y: auto;
}
@keyframes slideUp {
  from { transform: translateY(32px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}
.modal-handle { width: 32px; height: 3px; background: var(--border); border-radius: 2px; margin: 12px auto 0; transition: background .3s; }
.modal-head { padding: 14px 26px 12px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; transition: border-color .3s; }
.modal-title { font-family: 'Playfair Display', serif; font-size: 18px; font-style: italic; color: var(--text); }
.modal-x { background: none; border: none; color: var(--sub); font-size: 17px; cursor: pointer; }
.modal-body { padding: 20px 26px; }
.m-label { display: block; font-family: 'DM Mono', monospace; font-size: 8.5px; letter-spacing: 2px; text-transform: uppercase; color: var(--sub); margin-bottom: 7px; }
.m-group { margin-bottom: 18px; }
.photo-zone { border: 1px dashed var(--border); padding: 20px; text-align: center; cursor: pointer; background: color-mix(in srgb, var(--text) 2%, var(--bg)); transition: border-color .2s; }
.photo-zone:hover { border-color: var(--text); }
.pz-icon { font-size: 16px; opacity: .2; margin-bottom: 4px; }
.pz-lbl { font-family: 'DM Mono', monospace; font-size: 8.5px; letter-spacing: 2px; text-transform: uppercase; color: var(--sub); }
.m-input { width: 100%; background: color-mix(in srgb, var(--text) 3%, var(--bg)); border: 1px solid var(--border); color: var(--text); padding: 10px 13px; font-family: 'Playfair Display', serif; font-size: 14px; outline: none; transition: border-color .2s; }
.m-input:focus { border-color: var(--text); }
.m-input::placeholder { color: var(--sub); font-style: italic; }
.ac-box { position: absolute; top: 100%; left: 0; right: 0; background: var(--bg); border: 1px solid var(--border); border-top: none; z-index: 10; display: none; }
.ac-row { padding: 9px 13px; cursor: pointer; font-family: 'Playfair Display', serif; font-size: 14px; color: var(--text); border-bottom: 1px solid var(--border); transition: background .1s; }
.ac-row:hover { background: color-mix(in srgb, var(--text) 5%, var(--bg)); }
.s-sel { display: grid; grid-template-columns: repeat(3,1fr); gap: 4px; }
.s-opt { background: none; border: 1px solid var(--border); padding: 9px; text-align: center; cursor: pointer; transition: all .15s; }
.s-opt.on { background: var(--text); border-color: var(--text); }
.s-opt span { font-family: 'DM Mono', monospace; font-size: 8.5px; letter-spacing: 1px; text-transform: uppercase; color: var(--sub); }
.s-opt.on span { color: var(--bg); }
.modal-foot { padding: 10px 26px 24px; display: flex; justify-content: flex-end; gap: 8px; }
.btn-ghost { background: none; border: 1px solid var(--border); color: var(--sub); padding: 8px 16px; font-family: 'DM Mono', monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: all .2s; }
.btn-ghost:hover { border-color: var(--text); color: var(--text); }
.btn-solid { background: var(--text); border: none; color: var(--bg); padding: 8px 20px; font-family: 'DM Mono', monospace; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; transition: opacity .2s; }
.btn-solid:hover { opacity: .75; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: calc(var(--nav-h) + 14px); left: 50%;
  transform: translateX(-50%) translateY(10px);
  background: var(--text); color: var(--bg);
  padding: 8px 18px; font-family: 'DM Mono', monospace;
  font-size: 9px; letter-spacing: 1.5px; text-transform: uppercase;
  z-index: 900; opacity: 0; transition: all .24s; white-space: nowrap;
}
.toast.on { opacity: 1; transform: translateX(-50%) translateY(0); }

.mono { font-family: 'DM Mono', monospace; }
</style>
</head>
<body>
<div class="app">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="type-dots" id="type-dots">
      <div class="type-dot on"></div>
      <div class="type-dot"></div>
      <div class="type-dot"></div>
      <div class="type-dot"></div>
    </div>
    <div class="topbar-logo">Terroir</div>
    <div style="width:56px"></div>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- ‚îÄ‚îÄ CURATION ‚îÄ‚îÄ -->
    <div class="page on" id="pg-cur">
      <div class="cur-wrap">
        <div class="cur-header">
          <div class="cur-user">James ‚Äî Red</div>
          <div class="cur-line">Limestone-driven. Cool vintage. <em>Three wines worth your attention.</em></div>
        </div>
        <div class="type-track-wrap" id="cur-wrap">
          <div class="type-track" id="type-track">
            <div class="type-section" id="sec-red">
              <div class="card-grid" id="grid-red"></div>
              <div class="swipe-hint-row"><span class="swipe-hint-txt"></span><span class="swipe-hint-txt">white ‚Üí</span></div>
            </div>
            <div class="type-section" id="sec-white">
              <div class="card-grid" id="grid-white"></div>
              <div class="swipe-hint-row"><span class="swipe-hint-txt">‚Üê red</span><span class="swipe-hint-txt">sparkling ‚Üí</span></div>
            </div>
            <div class="type-section" id="sec-sparkling">
              <div class="card-grid" id="grid-sparkling"></div>
              <div class="swipe-hint-row"><span class="swipe-hint-txt">‚Üê white</span><span class="swipe-hint-txt">dessert ‚Üí</span></div>
            </div>
            <div class="type-section" id="sec-dessert">
              <div class="card-grid" id="grid-dessert"></div>
              <div class="swipe-hint-row"><span class="swipe-hint-txt">‚Üê sparkling</span><span class="swipe-hint-txt"></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ USER ‚îÄ‚îÄ -->
    <div class="page" id="pg-user">
      <div class="user-wrap">
        <div class="user-header">
          <div class="user-name-row">
            <div class="user-name">James</div>
            <div class="user-dots" id="user-dots">
              <div class="user-dot on"></div>
              <div class="user-dot"></div>
            </div>
          </div>
          <div class="user-meta">6 wines ¬∑ since 2024</div>
        </div>
        <div class="user-track-wrap">
          <div class="user-track" id="user-track">

            <!-- My Wines -->
            <div class="user-section" id="usec-wines">
              <div class="sec-title-row">
                <div class="sec-title">My Wines</div>
              </div>
              <div class="filter-row" id="filter-row">
                <button class="filter-pill on" data-filter="all">All</button>
                <button class="filter-pill" data-filter="tasted">Tasted</button>
                <button class="filter-pill" data-filter="wishlist">Wishlist</button>
                <button class="filter-pill" data-filter="dismissed">Dismissed</button>
              </div>
              <div class="cel-list" id="cel-list"></div>
            </div>

            <!-- Taste Map -->
            <div class="user-section" id="usec-taste">
              <div class="sec-title-row">
                <div class="sec-title">Taste Map</div>
              </div>
              <div class="taste-essay">
                <p>Prefers <em>mineral-forward structure</em> over fruit expression. Tannin restrained by acidity, cool-vintage tension preferred. Producer philosophy matters ‚Äî terroir-driven, low-intervention.</p>
              </div>
              <div class="viz-2col">
                <div class="viz-box">
                  <div class="viz-lbl">Regions</div>
                  <svg viewBox="0 0 360 195" style="width:100%" xmlns="http://www.w3.org/2000/svg">
                    <path d="M80,26 L140,17 L182,34 L178,88 L155,120 L110,127 L72,111 L66,65Z" fill="none" stroke="currentColor" stroke-width="1" opacity=".12"/>
                    <path d="M205,24 L236,21 L250,38 L257,68 L252,105 L236,136 L213,148 L202,115 L198,75 L194,45Z" fill="none" stroke="currentColor" stroke-width="1" opacity=".12"/>
                    <circle cx="144" cy="70" r="20" fill="#8b2635" opacity=".68"/>
                    <text x="144" y="67" text-anchor="middle" fill="white" font-size="7" font-family="DM Mono,monospace">Burgundy</text>
                    <text x="144" y="76" text-anchor="middle" fill="rgba(255,255,255,.5)" font-size="6" font-family="DM Mono,monospace">primary</text>
                    <circle cx="112" cy="96" r="8" fill="#8b2635" opacity=".32"/>
                    <text x="112" y="99" text-anchor="middle" fill="currentColor" font-size="6" font-family="DM Mono,monospace" opacity=".55">Loire</text>
                    <circle cx="222" cy="44" r="12" fill="#8b2635" opacity=".48"/>
                    <text x="222" y="41" text-anchor="middle" fill="currentColor" font-size="6.5" font-family="DM Mono,monospace" opacity=".75">Piemonte</text>
                    <text x="222" y="50" text-anchor="middle" fill="currentColor" font-size="5.5" font-family="DM Mono,monospace" opacity=".35">exploring</text>
                    <text x="122" y="175" text-anchor="middle" fill="currentColor" font-size="7" font-family="DM Mono,monospace" opacity=".15">FRANCE</text>
                    <text x="228" y="175" text-anchor="middle" fill="currentColor" font-size="7" font-family="DM Mono,monospace" opacity=".15">ITALY</text>
                  </svg>
                </div>
                <div class="viz-box">
                  <div class="viz-lbl">Varieties</div>
                  <div class="wcloud">
                    <span class="wc" style="font-size:32px;color:var(--text)">Pinot Noir</span>
                    <span class="wc" style="font-size:20px">Nebbiolo</span>
                    <span class="wc" style="font-size:16px">Chardonnay</span>
                    <span class="wc" style="font-size:15px">Cab. Franc</span>
                    <span class="wc" style="font-size:13px">Gamay</span>
                    <span class="wc" style="font-size:11px">Sagrantino</span>
                    <span class="wc" style="font-size:10px">Riesling</span>
                  </div>
                </div>
              </div>
              <div class="viz-box" style="border:1px solid var(--border);margin-top:1px;transition:border-color .3s">
                <div class="viz-lbl">Producer Network</div>
                <svg viewBox="0 0 600 165" style="width:100%" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="300" cy="82" r="24" fill="#8b2635" opacity=".7"/>
                  <text x="300" y="79" text-anchor="middle" fill="white" font-size="7.5" font-family="DM Mono,monospace">DRC</text>
                  <text x="300" y="89" text-anchor="middle" fill="rgba(255,255,255,.45)" font-size="6" font-family="DM Mono,monospace">Roman√©e</text>
                  <line x1="300" y1="82" x2="175" y2="46" stroke="currentColor" stroke-width="1.5" opacity=".15"/>
                  <circle cx="175" cy="46" r="18" fill="#8b2635" opacity=".28"/>
                  <text x="175" y="50" text-anchor="middle" fill="currentColor" font-size="7" font-family="DM Mono,monospace" opacity=".65">Leroy</text>
                  <line x1="300" y1="82" x2="428" y2="46" stroke="currentColor" stroke-width="1.5" opacity=".15"/>
                  <circle cx="428" cy="46" r="18" fill="#8b2635" opacity=".24"/>
                  <text x="428" y="43" text-anchor="middle" fill="currentColor" font-size="6.5" font-family="DM Mono,monospace" opacity=".65">M√©o-</text>
                  <text x="428" y="52" text-anchor="middle" fill="currentColor" font-size="6.5" font-family="DM Mono,monospace" opacity=".65">Camuzet</text>
                  <line x1="175" y1="46" x2="68" y2="32" stroke="currentColor" stroke-width="1" opacity=".08" stroke-dasharray="4,3"/>
                  <circle cx="68" cy="32" r="11" fill="none" stroke="currentColor" stroke-width="1" opacity=".15"/>
                  <text x="68" y="36" text-anchor="middle" fill="currentColor" font-size="6" font-family="DM Mono,monospace" opacity=".3">Bizot</text>
                  <line x1="175" y1="46" x2="82" y2="114" stroke="currentColor" stroke-width="1" opacity=".08" stroke-dasharray="4,3"/>
                  <circle cx="82" cy="114" r="11" fill="none" stroke="currentColor" stroke-width="1" opacity=".15"/>
                  <text x="82" y="118" text-anchor="middle" fill="currentColor" font-size="5.5" font-family="DM Mono,monospace" opacity=".3">Rossignol-T</text>
                  <line x1="428" y1="46" x2="532" y2="32" stroke="currentColor" stroke-width="1" opacity=".08" stroke-dasharray="4,3"/>
                  <circle cx="532" cy="32" r="11" fill="none" stroke="currentColor" stroke-width="1" opacity=".15"/>
                  <text x="532" y="36" text-anchor="middle" fill="currentColor" font-size="6" font-family="DM Mono,monospace" opacity=".3">Ponsot</text>
                  <line x1="300" y1="82" x2="412" y2="134" stroke="currentColor" stroke-width="1" opacity=".08" stroke-dasharray="4,3"/>
                  <circle cx="412" cy="134" r="11" fill="none" stroke="currentColor" stroke-width="1" opacity=".15"/>
                  <text x="412" y="138" text-anchor="middle" fill="currentColor" font-size="6" font-family="DM Mono,monospace" opacity=".3">Foillard</text>
                  <line x1="300" y1="82" x2="188" y2="134" stroke="currentColor" stroke-width="1" opacity=".08" stroke-dasharray="4,3"/>
                  <circle cx="188" cy="134" r="11" fill="none" stroke="currentColor" stroke-width="1" opacity=".15"/>
                  <text x="188" y="138" text-anchor="middle" fill="currentColor" font-size="6" font-family="DM Mono,monospace" opacity=".3">P. Bea</text>
                </svg>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div><!-- /main -->

  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <button class="bnav-btn on" id="bnav-cur">
      <div class="bnav-icon">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h10M4 18h7"/></svg>
      </div>
      <div class="bnav-label">Curation</div>
    </button>
    <div class="bnav-center"></div>
    <button class="bnav-btn" id="bnav-user">
      <div class="bnav-icon">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
      </div>
      <div class="bnav-label">User</div>
    </button>
    <button class="bnav-add" id="openModal">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
    </button>
  </div>

</div><!-- /app -->

<button class="theme-btn" id="themeBtn"></button>

<!-- DETAIL PANEL -->
<div class="detail-overlay" id="detail-overlay">
  <div class="detail-img-panel">
    <img id="detail-img" src="" alt=""/>
    <div class="detail-img-info">
      <div class="detail-wine-name" id="detail-name"></div>
      <div class="detail-producer" id="detail-producer"></div>
      <div class="detail-tags" id="detail-tags"></div>
    </div>
  </div>
  <div class="detail-chat-panel">
    <div class="detail-chat-head">
      <div class="detail-chat-title">Ask the sommelier</div>
      <button class="detail-close" id="detail-close">‚úï</button>
    </div>
    <div class="detail-chat-body" id="detail-chat-body"></div>
    <div class="detail-suggestions" id="detail-suggestions">
      <div class="sug-label">Suggested</div>
    </div>
    <div class="detail-input-row">
      <input class="detail-input" id="detail-input" type="text" placeholder="Ask anything about this wine..."/>
      <button class="detail-send" id="detail-send">Send</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modal-bg">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-head">
      <div class="modal-title">Record a wine</div>
      <button class="modal-x" id="closeModal">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="m-group">
        <label class="m-label">Label photo</label>
        <div class="photo-zone"><div class="pz-icon">üì∑</div><div class="pz-lbl">Shoot or upload</div></div>
      </div>
      <div class="m-group" style="position:relative">
        <label class="m-label">Wine name</label>
        <input class="m-input" id="wsearch" type="text" placeholder="Start typing..." autocomplete="off"/>
        <div class="ac-box" id="acbox"></div>
      </div>
      <div class="m-group">
        <label class="m-label">Status</label>
        <div class="s-sel">
          <div class="s-opt on"><span>Cellar</span></div>
          <div class="s-opt"><span>Tasted</span></div>
          <div class="s-opt"><span>Wishlist</span></div>
        </div>
      </div>
      <div class="m-group">
        <label class="m-label">Note (optional)</label>
        <input class="m-input" type="text" placeholder="Why this wine stays with you..." style="font-size:13px;font-family:'DM Sans',sans-serif"/>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn-ghost" id="cancelBtn">Cancel</button>
      <button class="btn-solid" id="saveBtn">Record</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DB = {
  red: [
    { name:'Barolo Villero', producer:'Conterno Fantino', vintage:'2016', region:'Barolo ¬∑ Piemonte',
      why:'Cool 2016. Tannin restrained by acidity. Iron, slate, dried rose ‚Äî fruit in the back.',
      hook:'2016 was one of the coldest Barolo vintages in a decade ‚Äî exactly the structure your profile responds to.',
      img:'https://images.vivino.com/thumbs/4RHhCzeXXB5soBMqVS9hMg_pb_x600.png', bg:'#1e1610',
      qa:[{q:"Why this wine for me?",a:"Your profile leans toward cool-vintage structure over fruit. 2016 Barolo was a cold year ‚Äî the tannins are present but never heavy, the acidity does the work."},
          {q:"Tell me about Conterno Fantino.",a:"Piedmont producer, family-run. They work Villero ‚Äî one of the more nuanced Barolo crus. Not the showiest, but consistent. Terroir-first approach."},
          {q:"Similar wines I might not know?",a:"Giacomo Conterno's Barbera d'Alba, or look at Vajra's Dolcetto. Same philosophy, different weight."}] },
    { name:'Saumur-Champigny', producer:'Clos Rougeard', vintage:'2015', region:'Loire ¬∑ Cab. Franc',
      why:'Graphite and tuffeau before fruit. Tobacco and cedar develop with time. Long finish.',
      hook:'Clos Rougeard is the only Loire producer whose Cab. Franc ages like Burgundy ‚Äî and you have none from Loire yet.',
      img:'https://images.vivino.com/thumbs/oGBSMKi-H0m2hBhSg0pplA_pb_x600.png', bg:'#101418',
      qa:[{q:"Why Cab. Franc for me?",a:"Your dismissed wines suggest you react negatively to new-world fruit density. Cab. Franc from Saumur is the opposite ‚Äî mineral, angular, restrained."},
          {q:"What's tuffeau?",a:"Volcanic tuff ‚Äî the chalk-like soil under Saumur. It drains well, holds temperature. Gives wines that graphite-smoke character you're reading in the description."},
          {q:"Similar wines?",a:"Baudry's Chinon, or Catherine & Pierre Breton. Same appellation philosophy."}] },
    { name:'Sagrantino di Montefalco', producer:'Paolo Bea', vintage:'2012', region:'Umbria ¬∑ Sagrantino',
      why:'Closed at first. Given time: violet, leather, dried herb in layers.',
      hook:'Paolo Bea farms without intervention ‚Äî the philosophy matches your producer preference exactly.',
      img:'https://images.vivino.com/thumbs/7UF8qKCi8aU3mMJzIHkRfA_pb_x600.png', bg:'#14101c',
      qa:[{q:"Why Paolo Bea specifically?",a:"Paolo Bea is one of the few producers who treats Sagrantino as a long-game wine. No shortcuts in the cellar. The 2012 has had time ‚Äî it's opening now."},
          {q:"Is Sagrantino hard to find?",a:"It is. Small appellation, limited export. Worth hunting for. The tannin structure is unlike anything else."},
          {q:"Should I decant?",a:"Yes. Two hours minimum. Preferably overnight in a cooler spot."}] },
    { name:"Morgon C√¥te du Py", producer:'Jean Foillard', vintage:'2019', region:'Beaujolais ¬∑ Gamay',
      why:'Blood and iris behind the acidity. Volcanic weight without heaviness.',
      hook:'C√¥te du Py sits on volcanic basalt ‚Äî the minerality here is structural, not decorative.',
      img:'https://images.vivino.com/thumbs/ue8QRcIxR7RBimlq4PJniA_pb_x600.png', bg:'#1a1010',
      qa:[{q:"Beaujolais ‚Äî is this serious?",a:"C√¥te du Py is granite and volcanic basalt. Foillard farms it like Burgundy. The resulting Gamay is nothing like the Nouveau category. Different fruit, different weight."},
          {q:"What's the 'blood and iris' about?",a:"Iron-rich soil from the volcanic rock. It comes through in the wine as a metallic-floral note. Unusual, but consistent with your preference for mineral-forward wines."},
          {q:"Other Foillard wines to try?",a:"His Morgon Corcelette, or the C√¥te du Py Vieilles Vignes in a good year."}] }
  ],
  white: [
    { name:'Puligny-Montrachet 1er Cru Les Pucelles', producer:'Domaine Leflaive', vintage:'2019', region:'Burgundy ¬∑ Chardonnay',
      why:'Lemon zest, white flower. Limestone backbone. Oak in the background, mineral throughout.',
      hook:'Leflaive is biodynamic ‚Äî the soil expression here is unfiltered, which is exactly what your profile is asking for.',
      img:'https://images.vivino.com/thumbs/qSBjYMlNGOoKzOH3oQ6YBg_pb_x600.png', bg:'#181610',
      qa:[{q:"Why this over Meursault?",a:"Your profile suggests you prefer tension over richness. Puligny leans more acidic and mineral than Meursault's butter-led style. Les Pucelles in particular is restrained for the appellation."},
          {q:"About Domaine Leflaive.",a:"Biodynamic since the 90s. Anne-Claude Leflaive rebuilt the estate around soil health. The wines reflect it ‚Äî structure without aggression."},
          {q:"A younger vintage to try?",a:"The 2020 is widely available and shows the same profile. Tighter than the 2019."}] },
    { name:'Riesling Clos Sainte-Hune', producer:'Trimbach', vintage:'2014', region:'Alsace ¬∑ Riesling',
      why:'Petrol and lime first. Honey, ginger, white peach with age. Acidity carries everything.',
      hook:'Riesling sits in your untouched cluster ‚Äî this is the most precise entry point into it.',
      img:'https://images.vivino.com/thumbs/vHpSLBszAagaUmkKrb-WUA_pb_x600.png', bg:'#101814',
      qa:[{q:"Why Riesling for me?",a:"Clos Sainte-Hune is about acidity and mineral aging, not sweetness. Your taste profile aligns with wines that reward patience ‚Äî this wine at 10 years is completely different from release."},
          {q:"What's the petrol note?",a:"A compound called TDN develops in Riesling with age and sun exposure. Not a flaw ‚Äî it's considered a marker of quality in aged Alsatian and German Riesling."},
          {q:"Other Trimbach to explore?",a:"The Cuv√©e Fr√©d√©ric √âmile is more available and shows similar aging potential."}] },
    { name:'Meursault Perri√®res 1er Cru', producer:'Comte Lafon', vintage:'2017', region:'Burgundy ¬∑ Chardonnay',
      why:'Butter and hazelnut, but not heavy. Wet gravel mineral in the texture. Smoke on the finish.',
      hook:'Perri√®res is the most mineral premier cru in Meursault ‚Äî the gravel subsoil keeps it leaner than the appellation average.',
      img:'https://images.vivino.com/thumbs/Cj9SgbEZe99U09yK5-YGOQ_pb_x600.png', bg:'#161410',
      qa:[{q:"Is this too rich for my profile?",a:"Perri√®res is the most mineral of Meursault's premier crus. Lafon's version specifically runs leaner than the appellation average. The gravel subsoil keeps the acidity high."},
          {q:"About Comte Lafon.",a:"Dominique Lafon is considered Meursault's benchmark producer. Biodynamic, low yields. The wines age unusually well for white Burgundy."},
          {q:"When to open the 2017?",a:"It's at a good window now. The 2017 vintage was warm but Lafon maintained freshness. Another 5 years won't hurt."}] }
  ],
  sparkling: [
    { name:'Champagne Blanc de Blancs Grand Cru', producer:'Salon', vintage:'2013', region:'Le Mesnil ¬∑ Chardonnay',
      why:'Chalk minerality through citrus and toast. Tension in the acidity from start to finish.',
      hook:'Salon only releases in exceptional vintages ‚Äî this is one of 4‚Äì5 in the past two decades.',
      img:'https://images.vivino.com/thumbs/VaXbNBnKLhAFmJXnpPWnAA_pb_x600.png', bg:'#101418',
      qa:[{q:"What makes Salon different?",a:"Salon only makes wine in exceptional vintages ‚Äî about 4-5 times per decade. Single vineyard, single variety, single vintage. The 2013 is considered one of the cleaner recent releases."},
          {q:"Why does chalk matter in sparkling?",a:"Chalk drainage forces roots deep. The resulting mineral expression comes through even after secondary fermentation. It's what separates Le Mesnil from other Champagne villages."},
          {q:"More affordable alternatives?",a:"Pierre P√©ters Blanc de Blancs, or Larmandier-Bernier. Same village philosophy, different price point."}] },
    { name:'Champagne Initial', producer:'Jacques Selosse', vintage:'NV', region:'Avize ¬∑ Chardonnay',
      why:'Oxidative ‚Äî walnut, apple, brioche. Biodynamic vineyard complexity in every bubble.',
      hook:'Selosse treats Champagne like white Burgundy ‚Äî soil-first, not house-style.',
      img:'https://images.vivino.com/thumbs/5p6zy5KAIBfD9YqeHUmrHA_pb_x600.png', bg:'#101610',
      qa:[{q:"What's the oxidative style about?",a:"Selosse uses barrel fermentation and extended lees aging, similar to white Burgundy. The result is less about freshness and more about depth. Polarizing, but consistent with your mineral preference."},
          {q:"Is NV reliable across batches?",a:"Selosse's NV releases vary by disgorgement date. The Initial is the most consistent entry point ‚Äî designed to show the house style across years."},
          {q:"Similar producers?",a:"Benoit Lahaye, or Cedric Bouchard for a different expression of the same philosophy."}] },
    { name:"Franciacorta Riserva AC", producer:"Ca' del Bosco", vintage:'2014', region:'Lombardy ¬∑ Chardonnay',
      why:'Yeast depth without weight. Pear, almond, limestone mineral in layers.',
      hook:'Italian sparkling is a gap in your profile ‚Äî Franciacorta from morainic soil is the sharpest entry point.',
      img:'https://images.vivino.com/thumbs/mMM4CKkkmGU6OqQiOKbCwQ_pb_x600.png', bg:'#141210',
      qa:[{q:"Why Franciacorta and not more Champagne?",a:"Your exploration profile has a gap in Italian sparkling. Franciacorta uses the same method as Champagne but different soil ‚Äî morainic, calcium-rich. Ca' del Bosco is the quality reference."},
          {q:"What's the difference from Prosecco?",a:"Completely different method. Prosecco is tank-fermented, simple. Franciacorta is bottle-fermented with extended aging ‚Äî structurally comparable to vintage Champagne."},
          {q:"Other Franciacorta producers?",a:"Bellavista's Vittorio Moretti Riserva, or Mosnel. Both show the same mineral-depth character."}] }
  ],
  dessert: [
    { name:'Tokaji Asz√∫ 6 Puttonyos', producer:'Royal Tokaji', vintage:'2013', region:'Tokaj ¬∑ Furmint',
      why:'Apricot and marmalade sweetness held by sharp acidity. Saffron, honey, long mineral finish.',
      hook:'The acidity here is higher than most dry whites ‚Äî the sweetness is incidental to the structure.',
      img:'https://images.vivino.com/thumbs/8_6s1GQtXWXVmRGh3mXQSw_pb_x600.png', bg:'#1c1408',
      qa:[{q:"Why Tokaji for someone who prefers dry wines?",a:"The 6 Puttonyos sweetness is countered by one of the highest natural acidities in any dessert wine. It reads less sweet than the numbers suggest. The mineral finish is significant."},
          {q:"What are Puttonyos?",a:"Originally baskets of botrytised grapes added to base wine. 6 Puttonyos means maximum sweetness level. Now a legal classification based on residual sugar."},
          {q:"Best way to serve it?",a:"Slightly chilled, small pour. It's meant to be considered, not drunk."}] },
    { name:"Sauternes 1er Grand Cru Class√©", producer:"Ch√¢teau d'Yquem", vintage:'2015', region:'Sauternes ¬∑ S√©millon',
      why:'Dense honey, ginger, orange peel in layers. Acidity supports the weight throughout.',
      hook:'2015 was a perfect botrytis year ‚Äî uniform, concentrated. The vintage justifies this recommendation.',
      img:'https://images.vivino.com/thumbs/MHkBTJGYUeF4OiN4MnfB0g_pb_x600.png', bg:'#181208',
      qa:[{q:"Isn't d'Yquem the obvious choice?",a:"It is the reference. But 2015 was a perfect botrytis year ‚Äî uniform, concentrated. This isn't a default recommendation; the vintage justifies it."},
          {q:"How long will it age?",a:"50+ years conservatively. D'Yquem from good vintages is one of the longest-lived wines made. The 2015 is barely opened."},
          {q:"Less expensive Sauternes?",a:"Ch√¢teau Guiraud or Rieussec. Same botrytis character, shorter aging curve."}] },
    { name:'Beerenauslese Gr√ºner Veltliner', producer:'Kracher', vintage:'2017', region:'Burgenland ¬∑ Gr√ºner Veltliner',
      why:'Tropical fruit, honey, clear acidity. Botrytis texture without stickiness. 30-second finish.',
      hook:'Gr√ºner Veltliner adds a spice element no other dessert grape has ‚Äî your profile has no Austrian wines yet.',
      img:'https://images.vivino.com/thumbs/oBWGJHiNQ3mNMDIeJYEe_Q_pb_x600.png', bg:'#141610',
      qa:[{q:"Why Austrian dessert wine?",a:"Kracher's BA sits in your untouched cluster ‚Äî you've not explored Austrian sweet wines. The Gr√ºner Veltliner variety gives it a spice element and acidity that Sauternes doesn't have."},
          {q:"What's Beerenauslese exactly?",a:"Individually hand-selected botrytised berries. More concentrated than Sp√§tlese, less than Trockenbeerenauslese. The BA category is where complexity and balance meet."},
          {q:"Other Kracher wines?",a:"The Welschriesling BA, or the Grande Cuv√©e TBA if you want to go further into the style."}] }
  ]
};

const cellarData = [
  { status:'cellar',    name:'Gevrey-Chambertin Vieilles Vignes', producer:'Rossignol-Trapet', vintage:'2018' },
  { status:'tasted',    name:'√âch√©zeaux Grand Cru',               producer:'Domaine de la Roman√©e-Conti', vintage:'2015' },
  { status:'wishlist',  name:'Clos Saint-Denis Grand Cru',        producer:'Domaine Ponsot', vintage:'‚Äî' },
  { status:'cellar',    name:'Bourgogne Blanc',                   producer:'Domaine Leflaive', vintage:'2020' },
  { status:'dismissed', name:'Napa Valley Cabernet Sauvignon',    producer:'Opus One', vintage:'2019' },
  { status:'wishlist',  name:'Vosne-Roman√©e 1er Les Chaumes',     producer:'M√©o-Camuzet', vintage:'‚Äî' }
];

const types = ['red','white','sparkling','dessert'];
let curTypeIdx = 0;
const pools = { red:[...DB.red], white:[...DB.white], sparkling:[...DB.sparkling], dessert:[...DB.dessert] };
// Track which card slot is available
const slotData = { red:[], white:[], sparkling:[], dessert:[] };

// ‚îÄ‚îÄ CARD RENDERING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getNext(type) {
  const pool = pools[type];
  if (!pool.length) { pools[type] = [...DB[type]]; return pools[type].shift(); }
  return pool.shift();
}

function makeCard(wine, type) {
  const wrap = document.createElement('div');
  wrap.className = 'card-wrap';

  const card = document.createElement('div');
  card.className = 'wine-card';
  card.style.background = wine.bg;

  card.innerHTML = `
    <img class="card-img" src="${wine.img}" alt="" loading="lazy" onerror="this.style.opacity=0"/>
    <div class="card-dbl-hint">double-click</div>
    <div class="card-overlay">
      <div class="ov-top">
        <div class="ov-producer">${wine.producer}</div>
        <div class="ov-why">${wine.why}</div>
        <div class="ov-hook">${wine.hook}</div>
        <div class="ov-meta">
          <span class="ov-vintage">${wine.vintage}</span>
          <span class="ov-region">${wine.region}</span>
        </div>
      </div>
      <div class="ov-actions">
        <button class="ov-btn" data-act="Added to Cellar">Cellar</button>
        <button class="ov-btn" data-act="Marked as Tasted">Tasted</button>
        <button class="ov-btn" data-act="Added to Wishlist">Wishlist</button>
        <button class="ov-btn x" data-act="Dismissed">‚úï</button>
      </div>
    </div>`;

  const label = document.createElement('div');
  label.className = 'card-name-label';
  label.textContent = wine.name;

  wrap.appendChild(card);
  wrap.appendChild(label);

  // Single click ‚Äî toggle overlay
  let clickTimer = null;
  card.addEventListener('click', () => {
    if (clickTimer) { clearTimeout(clickTimer); clickTimer = null; openDetail(wine); return; }
    clickTimer = setTimeout(() => { card.classList.toggle('active'); clickTimer = null; }, 220);
  });

  // Action buttons
  card.querySelectorAll('.ov-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.stopPropagation();
      dismissWrap(wrap, type, btn.dataset.act);
    });
  });

  // Swipe up to dismiss
  let sy = 0;
  card.addEventListener('touchstart', e => { sy = e.touches[0].clientY; }, {passive:true});
  card.addEventListener('touchend', e => { if (sy - e.changedTouches[0].clientY > 50) dismissWrap(wrap, type, 'Dismissed'); });

  return wrap;
}

function renderGrid(type) {
  const grid = document.getElementById('grid-' + type);
  grid.innerHTML = '';
  for (let i = 0; i < 3; i++) {
    const wine = getNext(type);
    if (!wine) continue;
    const wrap = makeCard(wine, type);
    wrap.style.animationDelay = (i * .07) + 's';
    grid.appendChild(wrap);
  }
}

function dismissWrap(wrap, type, msg) {
  wrap.classList.add('dismissing');
  setTimeout(() => {
    const grid = document.getElementById('grid-' + type);
    const idx = Array.from(grid.children).indexOf(wrap);
    wrap.remove();
    // Immediately insert new card at same position
    const wine = getNext(type);
    if (!wine) return;
    const newWrap = makeCard(wine, type);
    const children = grid.children;
    if (idx >= children.length) {
      grid.appendChild(newWrap);
    } else {
      grid.insertBefore(newWrap, children[idx]);
    }
  }, 360);
  toast(msg);
}

types.forEach(renderGrid);

// ‚îÄ‚îÄ TYPE SWIPE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const typeTrack = document.getElementById('type-track');
const typeDots  = document.querySelectorAll('.type-dot');
const typeLabels = ['Red','White','Sparkling','Dessert'];

function goType(idx) {
  idx = Math.max(0, Math.min(3, idx));
  curTypeIdx = idx;
  typeTrack.style.transform = `translateX(-${idx * 100}%)`;
  typeDots.forEach((d, i) => d.classList.toggle('on', i === idx));
  updateCurHeader();
}

function updateCurHeader() {
  document.querySelector('.cur-user').textContent = `James ‚Äî ${typeLabels[curTypeIdx]}`;
  const lines = {
    red: 'Limestone-driven. Cool vintage. <em>Three wines worth your attention.</em>',
    white: 'Mineral structure over oak. <em>Tension in every glass.</em>',
    sparkling: 'Chalk and acidity. <em>Precision over pleasure.</em>',
    dessert: 'Sweetness held by acidity. <em>Patience rewarded.</em>'
  };
  document.querySelector('.cur-line').innerHTML = lines[types[curTypeIdx]];
}

let tsX = 0;
const curWrap = document.getElementById('cur-wrap');
curWrap.addEventListener('touchstart', e => { tsX = e.touches[0].clientX; }, {passive:true});
curWrap.addEventListener('touchend', e => {
  const d = tsX - e.changedTouches[0].clientX;
  if (Math.abs(d) > 45) goType(curTypeIdx + (d > 0 ? 1 : -1));
});
let msX = 0, msDown = false;
curWrap.addEventListener('mousedown', e => { msDown=true; msX=e.clientX; });
curWrap.addEventListener('mouseup', e => {
  if (!msDown) return; msDown=false;
  const d = msX - e.clientX;
  if (Math.abs(d) > 55) goType(curTypeIdx + (d > 0 ? 1 : -1));
});
curWrap.addEventListener('mouseleave', () => { msDown=false; });

// ‚îÄ‚îÄ USER SWIPE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const userTrack = document.getElementById('user-track');
const userDots  = document.querySelectorAll('.user-dot');
let userIdx = 0;

function goUser(idx) {
  idx = Math.max(0, Math.min(1, idx));
  userIdx = idx;
  userTrack.style.transform = `translateX(-${idx * 100}%)`;
  userDots.forEach((d, i) => d.classList.toggle('on', i === idx));
}

const userWrap = document.querySelector('.user-track-wrap');
let utsX = 0;
userWrap.addEventListener('touchstart', e => { utsX = e.touches[0].clientX; }, {passive:true});
userWrap.addEventListener('touchend', e => {
  const d = utsX - e.changedTouches[0].clientX;
  if (Math.abs(d) > 45) goUser(userIdx + (d > 0 ? 1 : -1));
});
let umsX = 0, umsDown = false;
userWrap.addEventListener('mousedown', e => { umsDown=true; umsX=e.clientX; });
userWrap.addEventListener('mouseup', e => {
  if (!umsDown) return; umsDown=false;
  const d = umsX - e.clientX;
  if (Math.abs(d) > 55) goUser(userIdx + (d > 0 ? 1 : -1));
});
userWrap.addEventListener('mouseleave', () => { umsDown=false; });

// ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('bnav-cur').addEventListener('click', () => {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.getElementById('pg-cur').classList.add('on');
  document.getElementById('bnav-cur').classList.add('on');
  document.getElementById('bnav-user').classList.remove('on');
  document.getElementById('type-dots').style.display = 'flex';
});
document.getElementById('bnav-user').addEventListener('click', () => {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('on'));
  document.getElementById('pg-user').classList.add('on');
  document.getElementById('bnav-user').classList.add('on');
  document.getElementById('bnav-cur').classList.remove('on');
  document.getElementById('type-dots').style.display = 'none';
});

// ‚îÄ‚îÄ CELLAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCellar(filter = 'all') {
  const list = document.getElementById('cel-list');
  list.innerHTML = '';
  cellarData.filter(e => filter === 'all' || e.status === filter).forEach(e => {
    const bc = {cellar:'b-cellar',tasted:'b-tasted',wishlist:'b-wishlist',dismissed:'b-dismiss'}[e.status];
    const bt = {cellar:'Cellar',tasted:'Tasted',wishlist:'Wishlist',dismissed:'Dismissed'}[e.status];
    const vc = e.status === 'dismissed' ? 'var(--sub)' : 'var(--text)';
    const d = document.createElement('div');
    d.className = 'cel-entry';
    d.innerHTML = `
      <div class="cel-left">
        <div class="cel-name">${e.name}</div>
        <div class="cel-prod">${e.producer}</div>
      </div>
      <div class="cel-right">
        <div class="cel-badge ${bc}">${bt}</div>
        <div class="cel-vintage mono" style="color:${vc}">${e.vintage}</div>
      </div>`;
    list.appendChild(d);
  });
}
renderCellar();

document.querySelectorAll('.filter-pill').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-pill').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');
    renderCellar(btn.dataset.filter);
  });
});

// ‚îÄ‚îÄ DETAIL PANEL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activeWine = null;

function openDetail(wine) {
  activeWine = wine;
  document.getElementById('detail-img').src = wine.img;
  document.getElementById('detail-name').textContent = wine.name;
  document.getElementById('detail-producer').textContent = wine.producer;
  document.getElementById('detail-tags').innerHTML =
    `<span class="detail-tag">${wine.vintage}</span><span class="detail-tag">${wine.region}</span>`;

  // Initial sommelier message
  const body = document.getElementById('detail-chat-body');
  body.innerHTML = '';
  addMsg('sommelier', wine.why);

  // Suggestions
  const sugsEl = document.getElementById('detail-suggestions');
  sugsEl.innerHTML = '<div class="sug-label">Suggested</div>';
  (wine.qa || []).forEach(item => {
    const btn = document.createElement('button');
    btn.className = 'sug-btn';
    btn.textContent = item.q;
    btn.addEventListener('click', () => {
      addMsg('you', item.q);
      setTimeout(() => addMsg('sommelier', item.a), 400);
    });
    sugsEl.appendChild(btn);
  });

  document.getElementById('detail-overlay').classList.add('on');
}

function addMsg(role, text) {
  const body = document.getElementById('detail-chat-body');
  const msg = document.createElement('div');
  msg.className = 'chat-msg';
  msg.innerHTML = `
    <div class="chat-role">${role === 'sommelier' ? 'Sommelier' : 'You'}</div>
    <div class="chat-bubble ${role === 'sommelier' ? 'sommelier' : ''}">${text}</div>`;
  body.appendChild(msg);
  body.scrollTop = body.scrollHeight;
}

document.getElementById('detail-close').addEventListener('click', () => {
  document.getElementById('detail-overlay').classList.remove('on');
});
document.getElementById('detail-overlay').addEventListener('click', e => {
  if (e.target === document.getElementById('detail-overlay')) document.getElementById('detail-overlay').classList.remove('on');
});

const detailInput = document.getElementById('detail-input');
function sendDetailMsg() {
  const v = detailInput.value.trim();
  if (!v) return;
  addMsg('you', v);
  detailInput.value = '';
  setTimeout(() => addMsg('sommelier', "That's a good question. In a real version of this app, the sommelier would respond based on your taste profile and this wine's character. For now ‚Äî ask me anything when we build the real thing."), 500);
}
document.getElementById('detail-send').addEventListener('click', sendDetailMsg);
detailInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendDetailMsg(); });

// ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.getElementById('themeBtn').addEventListener('click', () => document.body.classList.toggle('dark'));

// ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const modalBg = document.getElementById('modal-bg');
document.getElementById('openModal').addEventListener('click', () => modalBg.classList.add('on'));
document.getElementById('closeModal').addEventListener('click', () => modalBg.classList.remove('on'));
document.getElementById('cancelBtn').addEventListener('click', () => modalBg.classList.remove('on'));
document.getElementById('saveBtn').addEventListener('click', () => { modalBg.classList.remove('on'); toast('Curation updated'); });
modalBg.addEventListener('click', e => { if (e.target === modalBg) modalBg.classList.remove('on'); });

document.querySelectorAll('.s-opt').forEach(opt => {
  opt.addEventListener('click', () => {
    document.querySelectorAll('.s-opt').forEach(o => o.classList.remove('on'));
    opt.classList.add('on');
  });
});

const wineList = ['Gevrey-Chambertin','Gevrey-Chambertin Vieilles Vignes','Chambolle-Musigny','Chambolle-Musigny Les Amoureuses','Vosne-Roman√©e','Nuits-Saint-Georges','Pommard','Volnay','Barolo','Barolo Villero','Barolo Cannubi','Barbaresco','Brunello di Montalcino','Ch√¢teauneuf-du-Pape','Hermitage','C√¥te-R√¥tie','Saumur-Champigny','Morgon','Sagrantino di Montefalco','Puligny-Montrachet','Meursault','Chassagne-Montrachet','Tokaji Asz√∫','Sauternes'];
const wsearch = document.getElementById('wsearch');
const acbox   = document.getElementById('acbox');
wsearch.addEventListener('input', () => {
  const v = wsearch.value;
  if (v.length < 2) { acbox.style.display='none'; return; }
  const hits = wineList.filter(w => w.toLowerCase().includes(v.toLowerCase())).slice(0,5);
  if (!hits.length) { acbox.style.display='none'; return; }
  acbox.innerHTML = hits.map(h => `<div class="ac-row">${h}</div>`).join('');
  acbox.style.display = 'block';
  acbox.querySelectorAll('.ac-row').forEach(r => r.addEventListener('click', () => { wsearch.value=r.textContent; acbox.style.display='none'; }));
});
document.addEventListener('click', e => { if (!wsearch.contains(e.target)) acbox.style.display='none'; });

// ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let toastTimer;
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('on');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('on'), 2200);
}
</script>
</body>
</html>
